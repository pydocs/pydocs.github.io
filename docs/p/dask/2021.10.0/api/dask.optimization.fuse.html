<!doctypehtml><html lang=en><meta charset=UTF-8><meta content=width=device-width,initial-scale=1.0 name=viewport><title>Document</title><link href=https://fonts.xz.style/serve/inter.css rel=stylesheet><link crossorigin=anonymous href=https://use.fontawesome.com/releases/v5.8.1/css/all.css integrity=sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css rel=stylesheet><script type=text/x-mathjax-config>
        // this should process only math inside  span with tex2jax_process class
    MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
        },
        "HTML-CSS": { fonts: ["TeX"] }
    });
    </script><script async src=https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js></script><link href=/papyri.css rel=stylesheet><style>header > brand, header>:first-child {
        border-right: 1px solid #ccc;
        border-left: 1px solid #ccc;
        padding: 16px;
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
        display: inline-block; 
        width: 167px;
    }
    pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: #ffffcc }
.highlight { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .ch { color: #888888 } /* Comment.Hashbang */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #cc0000; font-weight: bold } /* Comment.Preproc */
.highlight .cpf { color: #888888 } /* Comment.PreprocFile */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold; background-color: #fff0f0 } /* Comment.Special */
.highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #aa0000 } /* Generic.Error */
.highlight .gh { color: #333333 } /* Generic.Heading */
.highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #555555 } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #666666 } /* Generic.Subheading */
.highlight .gt { color: #aa0000 } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008800 } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #888888; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #0000DD; font-weight: bold } /* Literal.Number */
.highlight .s { color: #dd2200; background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #336699 } /* Name.Attribute */
.highlight .nb { color: #003388 } /* Name.Builtin */
.highlight .nc { color: #bb0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555 } /* Name.Decorator */
.highlight .ne { color: #bb0066; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066bb; font-weight: bold } /* Name.Function */
.highlight .nl { color: #336699; font-style: italic } /* Name.Label */
.highlight .nn { color: #bb0066; font-weight: bold } /* Name.Namespace */
.highlight .py { color: #336699; font-weight: bold } /* Name.Property */
.highlight .nt { color: #bb0066; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #336699 } /* Name.Variable */
.highlight .ow { color: #008800 } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #0000DD; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #0000DD; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #0000DD; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #0000DD; font-weight: bold } /* Literal.Number.Oct */
.highlight .sa { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Affix */
.highlight .sb { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Char */
.highlight .dl { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Delimiter */
.highlight .sd { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Doc */
.highlight .s2 { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #0044dd; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { color: #3333bb; background-color: #fff0f0 } /* Literal.String.Interpol */
.highlight .sx { color: #22bb22; background-color: #f0fff0 } /* Literal.String.Other */
.highlight .sr { color: #008800; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #aa6600; background-color: #fff0f0 } /* Literal.String.Symbol */
.highlight .bp { color: #003388 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0066bb; font-weight: bold } /* Name.Function.Magic */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700 } /* Name.Variable.Global */
.highlight .vi { color: #3333bb } /* Name.Variable.Instance */
.highlight .vm { color: #336699 } /* Name.Variable.Magic */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */</style></head><body class=tex2jax_ignore><header><brand><i class="fab fa-python"></i><a href=/>Home</a></brand><nav>/ <a href=/>p</a>  /  <div class=dropdown><a href=dask>dask</a> /  <div class=dropdown-content><a href=/p/IPython/8.2.0.dev/api/IPython.html>IPython</a><a href=/p/astropy/5.0/api/astropy.html>astropy</a><a href=/p/dask/2021.10.0/api/dask.html>dask</a><a href=/p/distributed/2021.10.0/api/distributed.html>distributed</a><a href=/p/matplotlib/3.5.1/api/matplotlib.html>matplotlib</a><a href=/p/networkx/2.7.2rc1.dev0/api/networkx.html>networkx</a><a href=/p/numpy/1.22.3/api/numpy.html>numpy</a><a href=/p/pandas/1.4.1/api/pandas.html>pandas</a><a href=/p/papyri/0.0.8/api/papyri.html>papyri</a><a href=/p/scipy/1.8.0/api/scipy.html>scipy</a><a href=/p/skimage/0.17.2/api/skimage.html>skimage</a></div></div><div class=dropdown><a href=/p/dask/2021.10.0/api/dask.html>2021.10.0</a> /  <div class=dropdown-content><a href=/p/dask/2021.10.0/api/dask.html>2021.10.0</a></div></div><div class=dropdown><a href=/p/dask/2021.10.0/api/dask.html>api</a> /  <div class=dropdown-content><a href=/p/dask/2021.10.0/api/dask.html>API</a><a href=/p/dask/2021.10.0/gallery>Gallery</a><a href=/p/dask/2021.10.0/examples>Examples</a></div></div><div class=dropdown><a class=dropbtn href=dask.html>dask</a>.</div><div class=dropdown><a class=dropbtn href=dask.optimization.html>optimization</a>. <div class=dropdown-content><a href=/p/dask/2021.10.0/api/dask._version.html>_version</a><a href=/p/dask/2021.10.0/api/dask.array.html>array</a><a href=/p/dask/2021.10.0/api/dask.base.html>base</a><a href=/p/dask/2021.10.0/api/dask.blockwise.html>blockwise</a><a href=/p/dask/2021.10.0/api/dask.callbacks.html>callbacks</a><a href=/p/dask/2021.10.0/api/dask.compatibility.html>compatibility</a><a href=/p/dask/2021.10.0/api/dask.config.html>config</a><a href=/p/dask/2021.10.0/api/dask.context.html>context</a><a href=/p/dask/2021.10.0/api/dask.core.html>core</a><a href=/p/dask/2021.10.0/api/dask.datasets.html>datasets</a><a href=/p/?/?/api/dask.delayed.html>delayed</a><a href=/p/dask/2021.10.0/api/dask.hashing.html>hashing</a><a href=/p/dask/2021.10.0/api/dask.highlevelgraph.html>highlevelgraph</a><a href=/p/dask/2021.10.0/api/dask.layers.html>layers</a><a href=/p/dask/2021.10.0/api/dask.local.html>local</a><a href=/p/dask/2021.10.0/api/dask.multiprocessing.html>multiprocessing</a><a href=/p/dask/2021.10.0/api/dask.optimization.html>optimization</a><a href=/p/dask/2021.10.0/api/dask.order.html>order</a><a href=/p/dask/2021.10.0/api/dask.sizeof.html>sizeof</a><a href=/p/dask/2021.10.0/api/dask.system.html>system</a><a href=/p/dask/2021.10.0/api/dask.threaded.html>threaded</a><a href=/p/dask/2021.10.0/api/dask.utils.html>utils</a><a href=/p/dask/2021.10.0/api/dask.utils_test.html>utils_test</a><a href=/p/dask/2021.10.0/api/dask.widgets.html>widgets</a></div></div><div class=dropdown><a class=dropbtn href=dask.optimization.fuse.html>fuse</a><div class=dropdown-content><a href=/p/dask/2021.10.0/api/dask.optimization.Default.html>Default</a><a href=/p/dask/2021.10.0/api/dask.optimization.SubgraphCallable.html>SubgraphCallable</a><a href=/p/dask/2021.10.0/api/dask.optimization._flat_set.html>_flat_set</a><a href=/p/dask/2021.10.0/api/dask.optimization._inplace_fuse_subgraphs.html>_inplace_fuse_subgraphs</a><a href=/p/dask/2021.10.0/api/dask.optimization.cull.html>cull</a><a href=/p/dask/2021.10.0/api/dask.optimization.default_fused_keys_renamer.html>default_fused_keys_renamer</a><a href=/p/dask/2021.10.0/api/dask.optimization.default_fused_linear_keys_renamer.html>default_fused_linear_keys_renamer</a><a href=/p/dask/2021.10.0/api/dask.optimization.functions_of.html>functions_of</a><a href=/p/dask/2021.10.0/api/dask.optimization.fuse.html>fuse</a><a href=/p/dask/2021.10.0/api/dask.optimization.fuse_linear.html>fuse_linear</a><a href=/p/dask/2021.10.0/api/dask.optimization.inline.html>inline</a><a href=/p/dask/2021.10.0/api/dask.optimization.inline_functions.html>inline_functions</a><a href=/p/dask/2021.10.0/api/dask.optimization.unwrap_partial.html>unwrap_partial</a></div></div></nav></header><div class=container><div class=sidenav><img src=/p/dask/2021.10.0/img/logo.png><a href=#>dask</a><a href=#>2021.10.0</a><hr><hr><a href=#section-Parameters>Parameters</a><a href=#section-Returns>Returns</a><a href=#section-backrefs>BackRef</a></div><code class=signature>fuse(dsk, keys=None, dependencies=None, ave_width=&LTdefault>, max_width=&LTdefault>, max_height=&LTdefault>, max_depth_new_edges=&LTdefault>, rename_keys=&LTdefault>, fuse_subgraphs=&LTdefault>)</code><p>This trades parallelism opportunities for faster scheduling by making tasks less granular. It can replace <code class=verbatim>fuse_linear</code> in optimization passes.</p><p>This optimization applies to all reductions--tasks that have at most one dependent--so it may be viewed as fusing "multiple input, single output" groups of tasks into a single task. There are many parameters to fine tune the behavior, which are described below. <code class=verbatim>ave_width</code> is the natural parameter with which to compare parallelism to granularity, so it should always be specified. Reasonable values for other parameters will be determined using <code class=verbatim>ave_width</code> if necessary.</p><h3 id=section-Parameters>Parameters</h3><dl><dt><a id="dsk: dict">dsk: dict</a> :</dt><dd><p>dask graph</p></dd><dt><a id="keys: list or set, optional">keys: list or set, optional</a> :</dt><dd><p>Keys that must remain in the returned dask graph</p></dd><dt><a id="dependencies: dict, optional">dependencies: dict, optional</a> :</dt><dd><p>{key: [list-of-keys]}. Must be a list to provide count of each key This optional input often comes from <code class=verbatim>cull</code></p></dd><dt><a id="ave_width: float (default 1)">ave_width: float (default 1)</a> :</dt><dd><p>Upper limit for <code class=verbatim>width = num_nodes / height</code> , a good measure of parallelizability. dask.config key: <code class=verbatim>optimization.fuse.ave-width</code></p></dd><dt><a id="max_width: int (default infinite)">max_width: int (default infinite)</a> :</dt><dd><p>Don't fuse if total width is greater than this. dask.config key: <code class=verbatim>optimization.fuse.max-width</code></p></dd><dt><a id="max_height: int or None (default None)">max_height: int or None (default None)</a> :</dt><dd><p>Don't fuse more than this many levels. Set to None to dynamically adjust to <code class=verbatim>1.5 + ave_width * log(ave_width + 1)</code> . dask.config key: <code class=verbatim>optimization.fuse.max-height</code></p></dd><dt><a id="max_depth_new_edges: int or None (default None)">max_depth_new_edges: int or None (default None)</a> :</dt><dd><p>Don't fuse if new dependencies are added after this many levels. Set to None to dynamically adjust to ave_width * 1.5. dask.config key: <code class=verbatim>optimization.fuse.max-depth-new-edges</code></p></dd><dt><a id="rename_keys: bool or func, optional (default True)">rename_keys: bool or func, optional (default True)</a> :</dt><dd><p>Whether to rename the fused keys with <code class=verbatim>default_fused_keys_renamer</code> or not. Renaming fused keys can keep the graph more understandable and comprehensive, but it comes at the cost of additional processing. If False, then the top-most key will be used. For advanced usage, a function to create the new name is also accepted. dask.config key: <code class=verbatim>optimization.fuse.rename-keys</code></p></dd><dt><a id=fuse_subgraphs>fuse_subgraphs</a> : bool or None, optional (default None)</dt><dd><p>Whether to fuse multiple tasks into <code class=verbatim>SubgraphCallable</code> objects. Set to None to let the default optimizer of individual dask collections decide. If no collection-specific default exists, None defaults to False. dask.config key: <code class=verbatim>optimization.fuse.subgraphs</code></p></dd></dl><h3 id=section-Returns>Returns</h3><dl><dt>dsk</dt><dd><p>output graph with keys fused</p></dd><dt>dependencies</dt><dd><p>dict mapping dependencies after fusion. Useful side effect to accelerate other downstream optimizations.</p></dd></dl><p>Fuse tasks that form reductions; more advanced than <code class=verbatim>fuse_linear</code></p><h3 id=section-Examples>Examples</h3> See : <h3 id=section-backrefs>Back References</h3><p>The following pages refer to to this document either explicitly or contain code examples using this.</p><code><a class=exists href=/p/dask/2021.10.0/api/dask.multiprocessing.get.html link>dask.multiprocessing.get</a></code><code><a class=exists href=/p/dask/2021.10.0/api/dask.optimization.fuse_linear.html link>dask.optimization.fuse_linear</a></code><h3>Local connectivity graph</h3><p>Hover to see nodes names; edges to Self not shown, Caped at 50 nodes.</p><p>Using a canvas is more power efficient and can get hundred of nodes ; but does not allow hyperlinks; , arrows or text (beyond on hover)</p><canvas class=graph height=500 width=800></canvas><p>SVG is more flexible but power hungry; and does not scale well to 50 + nodes.</p><svg class=graph height=500 width=600></svg><p>All aboves nodes referred to, (or are referred from) current nodes; Edges from Self to other have been omitted (or all nodes would be connected to the central node "self" which is not useful). Nodes are colored by the library they belong to, and scaled with the number of references pointing them</p><hr> File: /dask/optimization.py#429 <br> type: &LTclass 'function'> <br> Commit: <br><script src=https://d3js.org/d3.v4.min.js></script><script src=https://d3js.org/d3-selection-multi.v1.js></script><style>.node {};
        .link { stroke: #999; stroke-opacity: .6; stroke-width: 1px; };</style><script>window._data_graph={nodes:[{id:1,val:8,label:"dask.optimization.fuse_linear",mod:"dask",url:"/p/dask/2021.10.0/api/dask.optimization.fuse_linear"},{id:2,val:8,label:"dask.multiprocessing.get",mod:"dask",url:"/p/dask/2021.10.0/api/dask.multiprocessing.get"}],links:[]};</script><script src=/graph_canvas.js></script><script src=/graph_svg.js></script></div></body></html>