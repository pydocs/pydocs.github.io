<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://fonts.xz.style/serve/inter.css">
    <link rel="stylesheet"
          href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
          integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
          crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css">
    <script type="text/x-mathjax-config">
        // this should process only math inside  span with tex2jax_process class
    MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
        },
        "HTML-CSS": { fonts: ["TeX"] }
    });
    </script>
    <script async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js">
    </script>
    <link rel="stylesheet" href="/papyri.css">
    <link rel="stylesheet" href="/pygments.css">
<style>

    header > brand {
        /*border-right: 1px solid #ccc;
          border-left: 1px solid #ccc;*/
        margin-left: 15px;
        padding: 0px;
        display: inline-block; 
        width: 67px;
    }

    brand > a {
        text-decoration: None;

    }
    brand >a> img {
            display: inline-block;
    margin: 0;
    padding: 0;
    position: relative;
    bottom: -10px;

   }
    .container {
       max-width: 800px;
       padding-left: 210px;
       padding-top: 30px;
    }
</style>
</head><body class="tex2jax_ignore">
    <header>
        <brand><a href='/'><img src='/favicon.ico'/></a></brand>
        <nav> / <a href='/' >p</a>  &nbsp;/&nbsp; 
                <div class="dropdown">
                <a href=distributed>distributed</a>&nbsp;/&nbsp;
                    <div class="dropdown-content">
<a href="/p/IPython/8.3.0.dev/api/IPython.html">IPython</a>
<a href="/p/astropy/5.0/api/astropy.html">astropy</a>
<a href="/p/dask/2021.10.0/api/dask.html">dask</a>
<a href="/p/distributed/2021.10.0/api/distributed.html">distributed</a>
<a href="/p/matplotlib/3.5.1/api/matplotlib.html">matplotlib</a>
<a href="/p/networkx/2.7.2rc1.dev0/api/networkx.html">networkx</a>
<a href="/p/numpy/1.22.3/api/numpy.html">numpy</a>
<a href="/p/pandas/1.4.1/api/pandas.html">pandas</a>
<a href="/p/papyri/0.0.8/api/papyri.html">papyri</a>
<a href="/p/scipy/1.8.0/api/scipy.html">scipy</a>
<a href="/p/skimage/0.17.2/api/skimage.html">skimage</a>
                     </div>
                </div>
                <div class="dropdown">
                <a href='/p/distributed/2021.10.0/api/distributed.html'>2021.10.0</a>&nbsp;/&nbsp;
                    <div class="dropdown-content">
<a href="/p/distributed/2021.10.0/api/distributed.html">2021.10.0</a>
                    </div>
                </div>

                <div class="dropdown">
                    <a href='/p/distributed/2021.10.0/api/distributed.html'>API</a>&nbsp;/&nbsp;
                    <div class="dropdown-content">
                        <a href="/p/distributed/2021.10.0/api/distributed.html">API</a>
                        <a href="/p/distributed/2021.10.0/gallery">Gallery</a>
                        <a href="/p/distributed/2021.10.0/examples">Examples</a>
                        <a href="/p/distributed/2021.10.0/docs">Narrative</a>
                     </div>
                </div>

                    <div class="dropdown">
                            <a class="dropbtn" href='distributed.html'>distributed</a>.                    </div><!--end dropdown-->
                    <div class="dropdown">
                            <a class="dropbtn" href='distributed.semaphore.html'>semaphore</a>.                            <div class="dropdown-content">
<a href="/p/distributed/2021.10.0/api/distributed._concurrent_futures_thread.html">_concurrent_futures_thread</a>
<a href="/p/distributed/2021.10.0/api/distributed._version.html">_version</a>
<a href="/p/distributed/2021.10.0/api/distributed.active_memory_manager.html">active_memory_manager</a>
<a href="/p/distributed/2021.10.0/api/distributed.actor.html">actor</a>
<a href="/p/distributed/2021.10.0/api/distributed.batched.html">batched</a>
<a href="/p/distributed/2021.10.0/api/distributed.cfexecutor.html">cfexecutor</a>
<a href="/p/distributed/2021.10.0/api/distributed.client.html">client</a>
<a href="/p/distributed/2021.10.0/api/distributed.comm.html">comm</a>
<a href="/p/distributed/2021.10.0/api/distributed.compatibility.html">compatibility</a>
<a href="/p/distributed/2021.10.0/api/distributed.core.html">core</a>
<a href="/p/distributed/2021.10.0/api/distributed.deploy.html">deploy</a>
<a href="/p/distributed/2021.10.0/api/distributed.diagnostics.html">diagnostics</a>
<a href="/p/distributed/2021.10.0/api/distributed.diskutils.html">diskutils</a>
<a href="/p/distributed/2021.10.0/api/distributed.event.html">event</a>
<a href="/p/distributed/2021.10.0/api/distributed.http.html">http</a>
<a href="/p/distributed/2021.10.0/api/distributed.lock.html">lock</a>
<a href="/p/distributed/2021.10.0/api/distributed.locket.html">locket</a>
<a href="/p/distributed/2021.10.0/api/distributed.metrics.html">metrics</a>
<a href="/p/distributed/2021.10.0/api/distributed.multi_lock.html">multi_lock</a>
<a href="/p/distributed/2021.10.0/api/distributed.nanny.html">nanny</a>
<a href="/p/distributed/2021.10.0/api/distributed.node.html">node</a>
<a href="/p/distributed/2021.10.0/api/distributed.objects.html">objects</a>
<a href="/p/distributed/2021.10.0/api/distributed.preloading.html">preloading</a>
<a href="/p/distributed/2021.10.0/api/distributed.process.html">process</a>
<a href="/p/distributed/2021.10.0/api/distributed.proctitle.html">proctitle</a>
<a href="/p/distributed/2021.10.0/api/distributed.profile.html">profile</a>
<a href="/p/distributed/2021.10.0/api/distributed.protocol.html">protocol</a>
<a href="/p/distributed/2021.10.0/api/distributed.publish.html">publish</a>
<a href="/p/distributed/2021.10.0/api/distributed.pubsub.html">pubsub</a>
<a href="/p/distributed/2021.10.0/api/distributed.queues.html">queues</a>
<a href="/p/distributed/2021.10.0/api/distributed.recreate_tasks.html">recreate_tasks</a>
<a href="/p/distributed/2021.10.0/api/distributed.scheduler.html">scheduler</a>
<a href="/p/distributed/2021.10.0/api/distributed.security.html">security</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.html">semaphore</a>
<a href="/p/distributed/2021.10.0/api/distributed.sizeof.html">sizeof</a>
<a href="/p/distributed/2021.10.0/api/distributed.stealing.html">stealing</a>
<a href="/p/distributed/2021.10.0/api/distributed.system.html">system</a>
<a href="/p/distributed/2021.10.0/api/distributed.system_monitor.html">system_monitor</a>
<a href="/p/distributed/2021.10.0/api/distributed.threadpoolexecutor.html">threadpoolexecutor</a>
<a href="/p/distributed/2021.10.0/api/distributed.utils.html">utils</a>
<a href="/p/distributed/2021.10.0/api/distributed.utils_comm.html">utils_comm</a>
<a href="/p/distributed/2021.10.0/api/distributed.utils_perf.html">utils_perf</a>
<a href="/p/distributed/2021.10.0/api/distributed.variable.html">variable</a>
<a href="/p/distributed/2021.10.0/api/distributed.versions.html">versions</a>
<a href="/p/distributed/2021.10.0/api/distributed.widgets.html">widgets</a>
<a href="/p/distributed/2021.10.0/api/distributed.worker.html">worker</a>
<a href="/p/?/?/?/distributed.worker_client.html.html">worker_client</a>
                            </div>
                    </div><!--end dropdown-->
                    <div class="dropdown">
                            <a class="dropbtn" href='distributed.semaphore.Semaphore.html'>Semaphore</a>.                            <div class="dropdown-content">
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.html">Semaphore</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.SemaphoreExtension.html">SemaphoreExtension</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore._Watch.html">_Watch</a>
                            </div>
                    </div><!--end dropdown-->
                    <div class="dropdown">
                            <a class="dropbtn" >+</a>                            <div class="dropdown-content">
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.__aenter__.html">__aenter__</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.__aexit__.html">__aexit__</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.__await__.html">__await__</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.__del__.html">__del__</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.__enter__.html">__enter__</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.__exit__.html">__exit__</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.__getstate__.html">__getstate__</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.__init__.html">__init__</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.__setstate__.html">__setstate__</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore._acquire.html">_acquire</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore._refresh_leases.html">_refresh_leases</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore._register.html">_register</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore._release.html">_release</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.acquire.html">acquire</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.close.html">close</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.get_value.html">get_value</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.register.html">register</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.release.html">release</a>
<a href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.sync.html">sync</a>
                            </div>
                    </div><!--end dropdown-->
</nav>
    </header>
<div class='container'>
    <div class="sidenav">
        <img src="/p/distributed/2021.10.0/img/dask-logo.png"/>
    <a href="#">distributed</a>
    <a href="#">2021.10.0</a>
    <hr/>
    <hr/>
<a href="#section-Notes">Notes</a><a href="#section-Parameters">Parameters</a><a href="#section-backrefs">BackRef</a>
    </div><!--end sidenav-->







<!-- rendering Extended Summary -->
                       <p>This <a link href="https://en.wikipedia.org/wiki/Semaphore_(programming)" class='external'>semaphore</a> will track leases on the scheduler which can be acquired and released by an instance of this class. If the maximum amount of leases are already acquired, it is not possible to acquire more and the caller waits until another lease has been released.</p>

               <p>The lifetime or leases are controlled using a timeout. This timeout is refreshed in regular intervals by the         <code class='verbatim'>Client</code>
 of this instance and provides protection from deadlocks or resource starvation in case of worker failure. The timeout can be controlled using the configuration option         <code class='verbatim'>distributed.scheduler.locks.lease-timeout</code>
 and the interval in which the scheduler verifies the timeout is set using the option         <code class='verbatim'>distributed.scheduler.locks.lease-validation-interval</code>
.</p>

               <p>A noticeable difference to the Semaphore of the python standard library is that this implementation does not allow to release more often than it was acquired. If this happens, a warning is emitted but the internal state is not modified.</p>

                           <div class='admonition'>
    <div>warning</div>
        <p>This implementation is still in an experimental state and subtle changes in behavior may occur without any change in the major version of this library.</p>

</div>


                           <div class='admonition'>
    <div>warning</div>
        <p>This implementation is susceptible to lease overbooking in case of lease timeouts. It is advised to monitor log information and adjust above configuration options to suitable values for the user application.</p>

</div>



<h3 id="section-Notes">Notes</h3>
<!-- rendering Notes -->
                       <p>If a client attempts to release the semaphore but doesn&#39;t have a lease acquired, this will raise an exception.</p>

               <p>When a semaphore is closed, if, for that closed semaphore, a client attempts to:</p>

                          <ul>               <li>               <p>Acquire a lease: an exception will be raised.</p>

</li>
               <li>               <p>Release: a warning will be logged.</p>

</li>
               <li>               <p>Close: nothing will happen.</p>

</li>
            </ul>

               <p>dask executes functions by default assuming they are pure, when using semaphore acquire/releases inside such a function, it must be noted that there <em>are</em> in fact side-effects, thus, the function can no longer be considered pure. If this is not taken into account, this may lead to unexpected behavior.</p>


<h3 id="section-Parameters">Parameters</h3>
<dl>
<dt><a id="max_leases: int (optional)">max_leases: int (optional)</a> : </dt>
<dd>
<p>The maximum amount of leases that may be granted at the same time. This effectively sets an upper limit to the amount of parallel access to a specific resource. Defaults to 1.</p>

</dd>
<dt><a id="name: string (optional)">name: string (optional)</a> : </dt>
<dd>
<p>Name of the semaphore to acquire.  Choosing the same name allows two disconnected processes to coordinate.  If not given, a random name will be generated.</p>

</dd>
<dt><a id="register: bool">register: bool</a> : </dt>
<dd>
<p>If True, register the semaphore with the scheduler. This needs to be done before any leases can be acquired. If not done during initialization, this can also be done by calling the register method of this class. When registering, this needs to be awaited.</p>

</dd>
<dt><a id="scheduler_rpc: ConnectionPool">scheduler_rpc: ConnectionPool</a> : </dt>
<dd>
<p>The ConnectionPool to connect to the scheduler. If None is provided, it uses the worker or client pool. This paramter is mostly used for testing.</p>

</dd>
<dt><a id="loop: IOLoop">loop: IOLoop</a> : </dt>
<dd>
<p>The event loop this instance is using. If None is provided, reuse the loop of the active worker or client.</p>

</dd>
</dl>

<!-- rendering Summary -->
                       <p>Semaphore</p>


<h3 id="section-Examples">Examples</h3>
<span class='note'>This example is valid syntax, but we were not able to check execution</span><pre class='highlight compiled'><span class='nsl'>&gt;&gt;&gt; </span><span class="kn">from</span><span class=""> </span><a class="foo nn" href="/p/distributed/2021.10.0/api/distributed.html">distributed</a><span class=""> </span><span class="kn">import</span><span class=""> </span><a class="foo " href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.html">Semaphore</a><br><span class='nsl'>...&nbsp;</span><span class="">sem</span><span class=""> </span><span class="o">=</span><span class=""> </span><a class="foo " href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.html">Semaphore</a><span class="">(</span><span class="">max_leases</span><span class="o">=</span><span class="mi">2</span><span class="">,</span><span class=""> </span><span class="">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="s1">my_database</span><span class="s1">&#39;</span><span class="">)</span>
...
... def access_resource(s, sem):
...     # This automatically acquires a lease from the semaphore (if available) which will be
...     # released when leaving the context manager.
...     with sem:
...         pass
...
... futures = client.map(access_resource, range(10), sem=sem)
... client.gather(futures)
... # Once done, close the semaphore to clean up the state on scheduler side.
... sem.close()</pre>
            
         See :
    

    <h3 id='section-backrefs'>Back References</h3>
    <p>The following pages refer to to this document either explicitly or contain code examples using this.</p>

        <code><a link href="/p/distributed/2021.10.0/api/distributed.semaphore.Semaphore.html" class='exists'>distributed.semaphore.Semaphore</a></code>

<h3>Local connectivity graph</h3>
<p>Hover to see nodes names; edges to Self not shown, Caped at 50 nodes.</p>

<p> Using a canvas is more power efficient and can get hundred of nodes ; but does not allow hyperlinks; , arrows
or text (beyond on hover) </p> 
<canvas class='graph' width="800" height="500"></canvas>
<p> SVG is more flexible but power hungry; and does not scale well to 50 + nodes. </p> 

<svg class='graph' width="600" height="500"></svg>

<p>All aboves nodes referred to, (or are referred from) current nodes; Edges from Self to other have been omitted
(or all nodes would be connected to the central node "self" which is not useful). Nodes are colored by the library
they belong to, and scaled with the number of references pointing them</p>

<hr>

    File: /distributed/semaphore.py#272
<br/>

type: &lt;class &#39;type&#39;&gt; <br/>
Commit: <br/>

        <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-selection-multi.v1.js"></script>
    <style type="text/css">
        .node {};
        .link { stroke: #999; stroke-opacity: .6; stroke-width: 1px; };
    </style>
<script>
    window._data_graph = {"nodes": [{"id": 1, "val": 12.0, "label": "distributed", "mod": "distributed", "url": "/p/distributed/2021.10.0/api/distributed"}], "links": []};
</script>
<script type="text/javascript" src='/graph_canvas.js'></script>
<script type="text/javascript" src='/graph_svg.js'></script>


</div>
</body>
</html>