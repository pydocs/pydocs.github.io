<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet"
          href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
          integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
          crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css">
    <script type="text/x-mathjax-config">
      // this should process only math inside  span with tex2jax_process class
      MathJax.Hub.Config({
          extensions: ["tex2jax.js"],
          jax: ["input/TeX", "output/HTML-CSS"],
          tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true
          },
          "HTML-CSS": { fonts: ["TeX"] }
      });
    </script>
    <script async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js">
    </script>
    <link rel="stylesheet" href="/papyri.css">
    <link rel="stylesheet" href="/pygments.css">
<style>

    header > brand {
        /*border-right: 1px solid #ccc;
          border-left: 1px solid #ccc;*/
        margin-left: 15px;
        padding: 0px;
        display: inline-block; 
        width: 67px;
    }

    brand > a {
        text-decoration: None;

    }
    brand >a> img {
            display: inline-block;
    margin: 0;
    padding: 0;
    position: relative;
    bottom: -10px;

   }
    .container {
       max-width: 800px;
       padding-left: 210px;
       padding-top: 30px;
    }
</style>
</head><body class="tex2jax_ignore">
    <header>
        <brand><a href='/'><img src='/favicon.ico'/></a></brand>
        <nav> / <a href='/' >p</a>  &nbsp;/&nbsp; 
                <div class="dropdown">
                <a href=numpy>numpy</a>&nbsp;/&nbsp;
                    <div class="dropdown-content">
                     </div>
                </div>
                <div class="dropdown">
                <a href='/p/numpy/1.22.4/api/numpy'>1.22.4</a>&nbsp;/&nbsp;
                    <div class="dropdown-content">
<a href="/p/numpy/1.22.4/api/numpy">1.22.4</a>
                    </div>
                </div>

                <div class="dropdown">
                    <a href='/p/numpy/1.22.4/api/numpy'>docs</a>&nbsp;/&nbsp;
                    <div class="dropdown-content">
                        <a href="/p/numpy/1.22.4/api/numpy">API</a>
                        <a href="/p/numpy/1.22.4/gallery">Gallery</a>
                        <a href="/p/numpy/1.22.4/examples">Examples</a>
                        <a href="/p/numpy/1.22.4/docs">Narrative</a>
                     </div>
                </div>

</nav>
    </header>
    <div class='container'>

    <div class="sidenav">
        <img src="/p/numpy/1.22.4/img/numpy_logo.png"/>
    <a href="#">numpy</a>
    <a href="#">1.22.4</a>
        <a class='external'  href="https://pypi.org/project/numpy">Pypi</a>
        <a class='external' href="https://github.com/numpy/numpy">GitHub</a>
        <a class='external' href="https://numpy.org/">Homepage</a>
    <hr/>
        <a class='external' href="https://numpy.org/doc/1.22/">Other Docs</a>
    <hr/>
    </div><!--end sidenav-->







<h1>CPU build options</h1>

<h2>Description</h2>
               <p>The following options are mainly used to change the default behavior of optimizations that target certain CPU features:</p>

                          <ul>               <li>               <!-- deflist -->
           <dl>
               <dt><p>        <code class='verbatim'>--cpu-baseline</code>
: minimal set of required CPU features.</p>
</dt>
               <dd><p>Default value is         <code class='verbatim'>min</code>
 which provides the minimum CPU features that can    safely run on a wide range of platforms within the processor family.</p>
            <div class='admonition'>
    <div>note</div>
        <!-- deflist -->
           <dl>
               <dt><p>During the runtime, NumPy modules will fail to load if any of specified features</p>
</dt>
               <dd><p>are not supported by the target CPU (raises Python runtime error).</p>
</dd>
           </dl>

</div>

</dd>
           </dl>

</li>
               <li>               <!-- deflist -->
           <dl>
               <dt><p>        <code class='verbatim'>--cpu-dispatch</code>
: dispatched set of additional CPU features.</p>
</dt>
               <dd><p>Default value is         <code class='verbatim'>max -xop -fma4</code>
 which enables all CPU    features, except for AMD legacy features (in case of X86).</p>
            <div class='admonition'>
    <div>note</div>
        <!-- deflist -->
           <dl>
               <dt><p>During the runtime, NumPy modules will skip any specified features</p>
</dt>
               <dd><p>that are not available in the target CPU.</p>
</dd>
           </dl>

</div>

</dd>
           </dl>

</li>
            </ul>

               <p>These options are accessible through         <code class='verbatim'>distutils</code>
 commands <code><a href="/p/distutils/*/api/distutils.command.build.html" class='exists'>distutils.command.build</a></code>
, <code><a href="/p/distutils/*/api/distutils.command.build_clib.html" class='exists'>distutils.command.build_clib</a></code>
 and <code><a href="/p/distutils/*/api/distutils.command.build_ext.html" class='exists'>distutils.command.build_ext</a></code>
. They accept a set of         <code class='verbatim'>CPU features &lt;opt-supported-features&gt;</code>
 or groups of features that gather several features or         <code class='verbatim'>special options &lt;opt-special-options&gt;</code>
 that perform a series of procedures.</p>

                           <div class='admonition'>
    <div>note</div>
        <p>If         <code class='verbatim'>build_clib</code>
 or         <code class='verbatim'>build_ext</code>
 are not specified by the user, the arguments of         <code class='verbatim'>build</code>
 will be used instead, which also holds the default values.</p>

</div>


               <p>To customize both         <code class='verbatim'>build_ext</code>
 and         <code class='verbatim'>build_clib</code>
:      </p>

               <pre>cd /path/to/numpy
python setup.py build --cpu-baseline=&#34;avx2 fma3&#34; install --user</pre>
               <p>To customize only         <code class='verbatim'>build_ext</code>
:      </p>

               <pre>cd /path/to/numpy
python setup.py build_ext --cpu-baseline=&#34;avx2 fma3&#34; install --user</pre>
               <p>To customize only         <code class='verbatim'>build_clib</code>
:      </p>

               <pre>cd /path/to/numpy
python setup.py build_clib --cpu-baseline=&#34;avx2 fma3&#34; install --user</pre>
               <p>You can also customize CPU/build options through PIP command:      </p>

               <pre>pip install --no-use-pep517 --global-option=build \
--global-option=&#34;--cpu-baseline=avx2 fma3&#34; \
--global-option=&#34;--cpu-dispatch=max&#34; ./</pre>

<h2>Quick Start</h2>
               <p>In general, the default settings tend to not impose certain CPU features that may not be available on some older processors. Raising the ceiling of the baseline features will often improve performance and may also reduce binary size.</p>

               <p>The following are the most common scenarios that may require changing the default settings:</p>


<h3>I am building NumPy for my local use</h3>
               <p>And I do not intend to export the build to other users or target a different CPU than what the host has.</p>

               <p>Set <code class='not-implemented'>:None:None:`native`</code> for baseline, or manually specify the CPU features in case of option <code class='not-implemented'>:None:None:`native`</code> isn&#39;t supported by your platform:      </p>

               <pre>python setup.py build --cpu-baseline=&#34;native&#34; bdist</pre>
               <p>Building NumPy with extra CPU features isn&#39;t necessary for this case, since all supported features are already defined within the baseline features:      </p>

               <pre>python setup.py build --cpu-baseline=native --cpu-dispatch=none bdist</pre>
                           <div class='admonition'>
    <div>note</div>
        <p>A fatal error will be raised if <code class='not-implemented'>:None:None:`native`</code> isn&#39;t supported by the host platform.</p>

</div>



<h3>I do not want to support the old processors of the `x86` architecture</h3>
               <p>Since most of the CPUs nowadays support at least <code class='not-implemented'>:None:None:`AVX`</code>, <code class='not-implemented'>:None:None:`F16C`</code> features, you can use:      </p>

               <pre>python setup.py build --cpu-baseline=&#34;avx f16c&#34; bdist</pre>
                           <div class='admonition'>
    <div>note</div>
        <p>        <code class='verbatim'>--cpu-baseline</code>
 force combine all implied features, so there&#39;s no need to add SSE features.</p>

</div>



<h3>I&#39;m facing the same case above but with `ppc64` architecture</h3>
               <p>Then raise the ceiling of the baseline features to Power8:      </p>

               <pre>python setup.py build --cpu-baseline=&#34;vsx2&#34; bdist</pre>

<h3>Having issues with `AVX512` features?</h3>
               <p>You may have some reservations about including of <code class='not-implemented'>:None:None:`AVX512`</code> or any other CPU feature and you want to exclude from the dispatched features:      </p>

               <pre>python setup.py build --cpu-dispatch=&#34;max -avx512f -avx512cd \
-avx512_knl -avx512_knm -avx512_skx -avx512_clx -avx512_cnl -avx512_icl&#34; \
bdist</pre>
                          <pre class='not-implemented'>
            &lt;Unimplemented &#39;target&#39; &#39;.. _opt-supported-features:&#39;&gt;
           </pre>


<h2>Supported Features</h2>
               <p>The names of the features can express one feature or a group of features, as shown in the following tables supported depend on the lowest interest:</p>

                           <div class='admonition'>
    <div>note</div>
        <p>The following features may not be supported by all compilers, also some compilers may produce different set of implied features when it comes to features like         <code class='verbatim'>AVX512</code>
,         <code class='verbatim'>AVX2</code>
, and         <code class='verbatim'>FMA3</code>
. See <code class='not-implemented'>:None:ref:`opt-platform-differences`</code> for more details.</p>

</div>


               <pre class='not-implemented'>
.. include:: generated_tables/cpu_features.inc
    </pre>


                          <pre class='not-implemented'>
            &lt;Unimplemented &#39;target&#39; &#39;.. _opt-special-options:&#39;&gt;
           </pre>


<h2>Special Options</h2>
                          <ul>               <li>               <p>        <code class='verbatim'>NONE</code>
: enable no features.</p>

</li>
               <li>               <p>        <code class='verbatim'>NATIVE</code>
: Enables all CPU features that supported by the host CPU,   this operation is based on the compiler flags (        <code class='verbatim'>-march=native</code>
,         <code class='verbatim'>-xHost</code>
,         <code class='verbatim'>/QxHost</code>
)</p>

</li>
               <li>               <p>        <code class='verbatim'>MIN</code>
: Enables the minimum CPU features that can safely run on a wide range of platforms:</p>

               <pre class='not-implemented'>
.. table:: 
    [&#39;align&#39;, &#39;left&#39;]
    ======================================  =======================================
       For Arch                               Implies
      ======================================  =======================================
       x86 (32-bit mode)                      ``SSE`` ``SSE2``
       x86_64                                 ``SSE`` ``SSE2`` ``SSE3``
       IBM/POWER (big-endian mode)            ``NONE``
       IBM/POWER (little-endian mode)         ``VSX`` ``VSX2``
       ARMHF                                  ``NONE``
       ARM64 A.K. AARCH64                     ``NEON`` ``NEON_FP16`` ``NEON_VFPV4``
                                              ``ASIMD``
       IBM/ZSYSTEM(S390X)                     ``NONE``
      ======================================  =======================================</pre>


</li>
               <li>               <p>        <code class='verbatim'>MAX</code>
: Enables all supported CPU features by the compiler and platform.</p>

</li>
               <li>               <p>        <code class='verbatim'>Operators-/+</code>
: remove or add features, useful with options         <code class='verbatim'>MAX</code>
,         <code class='verbatim'>MIN</code>
 and         <code class='verbatim'>NATIVE</code>
.</p>

</li>
            </ul>


<h2>Behaviors</h2>
                          <ul>               <li>               <p>CPU features and other options are case-insensitive, for example:      </p>

               <pre>python setup.py build --cpu-dispatch=&#34;SSE41 avx2 FMA3&#34;</pre>
</li>
               <li>               <p>The order of the requested optimizations doesn&#39;t matter:      </p>

               <pre>python setup.py build --cpu-dispatch=&#34;SSE41 AVX2 FMA3&#34;
# equivalent to
python setup.py build --cpu-dispatch=&#34;FMA3 AVX2 SSE41&#34;</pre>
</li>
               <li>               <p>Either commas or spaces or &#39;+&#39; can be used as a separator,   for example:      </p>

               <pre>python setup.py build --cpu-dispatch=&#34;avx2 avx512f&#34;
# or
python setup.py build --cpu-dispatch=avx2,avx512f
# or
python setup.py build --cpu-dispatch=&#34;avx2+avx512f&#34;</pre>
               <p>all works but arguments should be enclosed in quotes or escaped   by backslash if any spaces are used.</p>

</li>
               <li>               <p>        <code class='verbatim'>--cpu-baseline</code>
 combines all implied CPU features, for example:      </p>

               <pre>python setup.py build --cpu-baseline=sse42
# equivalent to
python setup.py build --cpu-baseline=&#34;sse sse2 sse3 ssse3 sse41 popcnt sse42&#34;</pre>
</li>
               <li>               <p>        <code class='verbatim'>--cpu-baseline</code>
 will be treated as &#34;native&#34; if compiler native flag           <code class='verbatim'>-march=native</code>
 or         <code class='verbatim'>-xHost</code>
 or         <code class='verbatim'>/QxHost</code>
 is enabled through environment variable   <code class='not-implemented'>:None:None:`CFLAGS`</code>:      </p>

               <pre>export CFLAGS=&#34;-march=native&#34;
python setup.py install --user
# is equivalent to
python setup.py build --cpu-baseline=native install --user</pre>
</li>
               <li>               <p>        <code class='verbatim'>--cpu-baseline</code>
 escapes any specified features that aren&#39;t supported   by the target platform or compiler rather than raising fatal errors.</p>

                           <blockquote>            <div class='admonition'>
    <div>note</div>
        <!-- deflist -->
           <dl>
               <dt><p>Since         <code class='verbatim'>--cpu-baseline</code>
 combines all implied features, the maximum</p>
</dt>
               <dd><p>supported of implied features will be enabled rather than escape all of them.    For example:        </p>
<pre># Requesting `AVX2,FMA3` but the compiler only support **SSE** features
python setup.py build --cpu-baseline=&#34;avx2 fma3&#34;
# is equivalent to
python setup.py build --cpu-baseline=&#34;sse sse2 sse3 ssse3 sse41 popcnt sse42&#34;</pre></dd>
           </dl>

</div>

</blockquote>

</li>
               <li>               <p>        <code class='verbatim'>--cpu-dispatch</code>
 does not combain any of implied CPU features,   so you must add them unless you want to disable one or all of them:      </p>

               <pre># Only dispatches AVX2 and FMA3
python setup.py build --cpu-dispatch=avx2,fma3
# Dispatches AVX and SSE features
python setup.py build --cpu-baseline=ssse3,sse41,sse42,avx,avx2,fma3</pre>
</li>
               <li>               <p>        <code class='verbatim'>--cpu-dispatch</code>
 escapes any specified baseline features and also escapes   any features not supported by the target platform or compiler without raising   fatal errors.</p>

</li>
            </ul>

               <p>Eventually, you should always check the final report through the build log to verify the enabled features. See         <code class='verbatim'>opt-build-report</code>
 for more details.</p>

                          <pre class='not-implemented'>
            &lt;Unimplemented &#39;target&#39; &#39;.. _opt-platform-differences:&#39;&gt;
           </pre>


<h2>Platform differences</h2>
               <p>Some exceptional conditions force us to link some features together when it come to certain compilers or architectures, resulting in the impossibility of building them separately.</p>

               <p>These conditions can be divided into two parts, as follows:</p>

               <p><strong>Architectural compatibility</strong></p>

               <p>The need to align certain CPU features that are assured to be supported by successive generations of the same architecture, some cases:</p>

                          <ul>               <li>               <p>On ppc64le         <code class='verbatim'>VSX(ISA 2.06)</code>
 and         <code class='verbatim'>VSX2(ISA 2.07)</code>
 both imply one another since the   first generation that supports little-endian mode is Power-8`(ISA 2.07)`</p>

</li>
               <li>               <p>On AArch64         <code class='verbatim'>NEON NEON_FP16 NEON_VFPV4 ASIMD</code>
 implies each other since they are part of the   hardware baseline.</p>

</li>
            </ul>

               <p>For example:      </p>

               <pre># On ARMv8/A64, specify NEON is going to enable Advanced SIMD
# and all predecessor extensions
python setup.py build --cpu-baseline=neon
# which equivalent to
python setup.py build --cpu-baseline=&#34;neon neon_fp16 neon_vfpv4 asimd&#34;</pre>
                           <div class='admonition'>
    <div>note</div>
        <p>Please take a deep look at <code class='not-implemented'>:None:ref:`opt-supported-features`</code>, in order to determine the features that imply one another.</p>

</div>


               <p><strong>Compilation compatibility</strong></p>

               <p>Some compilers don&#39;t provide independent support for all CPU features. For instance <strong>Intel</strong>&#39;s compiler doesn&#39;t provide separated flags for         <code class='verbatim'>AVX2</code>
 and         <code class='verbatim'>FMA3</code>
, it makes sense since all Intel CPUs that comes with         <code class='verbatim'>AVX2</code>
 also support         <code class='verbatim'>FMA3</code>
, but this approach is incompatible with other <strong>x86</strong> CPUs from <strong>AMD</strong> or <strong>VIA</strong>.</p>

               <p>For example:      </p>

               <pre># Specify AVX2 will force enables FMA3 on Intel compilers
python setup.py build --cpu-baseline=avx2
# which equivalent to
python setup.py build --cpu-baseline=&#34;avx2 fma3&#34;</pre>
               <p>The following tables only show the differences imposed by some compilers from the general context that been shown in the         <code class='verbatim'>opt-supported-features</code>
 tables:</p>

                           <div class='admonition'>
    <div>note</div>
        <p>Features names with strikeout represent the unsupported CPU features.</p>

</div>


               <pre class='not-implemented'>
.. raw:: html
    &lt;style&gt;
        .enabled-feature {color:green; font-weight:bold;}
        .disabled-feature {color:red; text-decoration: line-through;}
    &lt;/style&gt;</pre>


               <pre class='not-implemented'>
.. role:: enabled
    [&#39;class&#39;, &#39;enabled-feature&#39;]
    </pre>


               <pre class='not-implemented'>
.. role:: disabled
    [&#39;class&#39;, &#39;disabled-feature&#39;]
    </pre>


               <pre class='not-implemented'>
.. include:: generated_tables/compilers-diff.inc
    </pre>


                          <pre class='not-implemented'>
            &lt;Unimplemented &#39;target&#39; &#39;.. _opt-build-report:&#39;&gt;
           </pre>


<h2>Build report</h2>
               <p>In most cases, the CPU build options do not produce any fatal errors that lead to hanging the build. Most of the errors that may appear in the build log serve as heavy warnings due to the lack of some expected CPU features by the compiler.</p>

               <p>So we strongly recommend checking the final report log, to be aware of what kind of CPU features are enabled and what are not.</p>

               <p>You can find the final report of CPU optimizations at the end of the build log, and here is how it looks on x86_64/gcc:</p>

               <pre class='not-implemented'>
.. raw:: html
    &lt;style&gt;#build-report .highlight-bash pre{max-height:450px; overflow-y: scroll;}&lt;/style&gt;</pre>


               <pre class='not-implemented'>
.. literalinclude:: log_example.txt
    [&#39;language&#39;, &#39;bash&#39;]
    </pre>


               <p>As you see, there is a separate report for each of         <code class='verbatim'>build_ext</code>
 and         <code class='verbatim'>build_clib</code>
 that includes several sections, and each section has several values, representing the following:</p>

               <p><strong>Platform</strong>:</p>

                          <ul>               <li>               <p>        <code class='verbatim'>Architecture</code>
: The architecture name of target CPU. It should be one of           <code class='verbatim'>x86</code>
,         <code class='verbatim'>x64</code>
,         <code class='verbatim'>ppc64</code>
,         <code class='verbatim'>ppc64le</code>
,         <code class='verbatim'>armhf</code>
,         <code class='verbatim'>aarch64</code>
,         <code class='verbatim'>s390x</code>
 or         <code class='verbatim'>unknown</code>
.</p>

</li>
               <li>               <p>        <code class='verbatim'>Compiler</code>
: The compiler name. It should be one of   gcc, clang, msvc, icc, iccw or unix-like.</p>

</li>
            </ul>

               <p><strong>CPU baseline</strong>:</p>

                          <ul>               <li>               <p>        <code class='verbatim'>Requested</code>
: The specific features and options to         <code class='verbatim'>--cpu-baseline</code>
 as-is.</p>

</li>
               <li>               <p>        <code class='verbatim'>Enabled</code>
: The final set of enabled CPU features.</p>

</li>
               <li>               <p>        <code class='verbatim'>Flags</code>
: The compiler flags that were used to all NumPy <code class='not-implemented'>:None:None:`C/C++`</code> sources   during the compilation except for temporary sources that have been used for generating   the binary objects of dispatched features.</p>

</li>
               <li>               <p>        <code class='verbatim'>Extra checks</code>
: list of internal checks that activate certain functionality   or intrinsics related to the enabled features, useful for debugging when it comes   to developing SIMD kernels.</p>

</li>
            </ul>

               <p><strong>CPU dispatch</strong>:</p>

                          <ul>               <li>               <p>        <code class='verbatim'>Requested</code>
: The specific features and options to         <code class='verbatim'>--cpu-dispatch</code>
 as-is.</p>

</li>
               <li>               <p>        <code class='verbatim'>Enabled</code>
: The final set of enabled CPU features.</p>

</li>
               <li>               <p>        <code class='verbatim'>Generated</code>
: At the beginning of the next row of this property,   the features for which optimizations have been generated are shown in the   form of several sections with similar properties explained as follows:</p>

                          <ul>               <li>               <p>        <code class='verbatim'>One or multiple dispatched feature</code>
: The implied CPU features.</p>

</li>
               <li>               <p>        <code class='verbatim'>Flags</code>
: The compiler flags that been used for these features.</p>

</li>
               <li>               <p>        <code class='verbatim'>Extra checks</code>
: Similar to the baseline but for these dispatched features.</p>

</li>
               <li>               <p>        <code class='verbatim'>Detect</code>
: Set of CPU features that need be detected in runtime in order to     execute the generated optimizations.</p>

</li>
               <li>               <p>The lines that come after the above property and end with a &#39;:&#39; on a separate line,     represent the paths of c/c++ sources that define the generated optimizations.</p>

</li>
            </ul>

</li>
            </ul>


<h2>Runtime Trace</h2>
               <p>To be completed.</p>


<h3 id="section-Examples">Examples</h3>
         See :
    


<h3>Local connectivity graph</h3>
<p>Hover to see nodes names; edges to Self not shown, Caped at 50 nodes.</p>

<p> Using a canvas is more power efficient and can get hundred of nodes ; but does not allow hyperlinks; , arrows
or text (beyond on hover) </p> 
<canvas class='graph' width="800" height="500"></canvas>
<p> SVG is more flexible but power hungry; and does not scale well to 50 + nodes. </p> 

<svg class='graph' width="600" height="500"></svg>

<p>All aboves nodes referred to, (or are referred from) current nodes; Edges from Self to other have been omitted
(or all nodes would be connected to the central node "self" which is not useful). Nodes are colored by the library
they belong to, and scaled with the number of references pointing them</p>

<hr>

    GitHub : <a class='external' href='https://github.com/numpy/numpy/blob/v1.22.3/None#LNone'>None#None</a>
<br/>

type: None <br/>
Commit: <br/>

        <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-selection-multi.v1.js"></script>
    <style type="text/css">
        .node {};
        .link { stroke: #999; stroke-opacity: .6; stroke-width: 1px; };
    </style>
<script>
    window._data_graph = {};
</script>
<script type="text/javascript" src='/graph_canvas.js'></script>
<script type="text/javascript" src='/graph_svg.js'></script>


</div>
</body>
</html>